<!DOCTYPE html>
<html>
<head>
	<title>גני שעשועים בירושלים</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

 	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
 	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="Leaflet.MakiMarkers.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
	<div id="map"></div>
	<script type="text/javascript">

		var MAP_CENTER = [31.77, 35.19];
		var MAP_BOUNDS = [L.latLng(31.89, 35.14), L.latLng(31.71, 35.27)];
		var DEFAULT_ZOOM = 13;
		L.MakiMarkers.accessToken = "pk.eyJ1IjoibmlyeWFyaXYiLCJhIjoiQjdJeWdqZyJ9.pZOwn6stABGoptmp0DH1wg";
		var playgroundIcon = L.MakiMarkers.icon({icon: "playground", color: "#85AFDF", size: "m"});
		var parkIcon = L.MakiMarkers.icon({icon: "park", color: "#85AFDF", size: "m"});

		var map = L.map('map', { scrollWheelZoom: true, maxBounds: MAP_BOUNDS}).setView(MAP_CENTER, DEFAULT_ZOOM);
		//map.locate({setView : true, maxZoom: 13});
		// tile_url = 'http://{s}.tiles.mapbox.com/v3/niryariv.map-n3zuwkkz/{z}/{x}/{y}.png';
		var tile_url = "http://niryariv.github.io/israel_tiles/{z}/{x}/{y}.png";
		L.tileLayer(tile_url, {
			maxZoom: 16,
			minZoom: 9
		}).addTo(map);

		function onEachFeature(feature, layer) {
			if (feature.geometry.type === 'Point') {
				var coords = feature.geometry.coordinates;
				var icon = feature.properties.park === "yes" ? parkIcon : playgroundIcon;
				var marker = L.marker([coords[1], coords[0]], {icon: icon});
				marker.bindPopup(generatePopup(feature));
				marker.addTo(map);
			}
		}
		$.getJSON("playgrounds.geo.json", function(playgrounds) {
   			L.geoJSON(playgrounds, {onEachFeature: onEachFeature});
		});

		function generatePopup(playground) {
			var props = [
				{name:'addressdescription', title:'מיקום', icon: ''},
				{name:'shadow', title:'צל', icon: '<span class="glyphicon glyphicon-certificate" aria-hidden="true" style="color:#d65d2b"></span>'},
				{name:'accessbility', title:'נגישות', icon: '<span class="glyphicon glyphicon-warning-sign" aria-hidden="true" style="color:black"></span>'},
				{name:'facility', title:'מתקנים', icon: ''},
				{name:'water', title:'מים', icon: ''},
				{name:'surface', title:'משטח', icon: ''},
				{name:'age', title:'גילאים', icon: ''}];

			var popupContent = `<h4>${playground.properties.name}</h4><table class="marker-table">`;
			props.forEach(function(prop) {
				popupContent += `<tr><td>${prop.icon} ${playground.properties[prop.name]} </td><th>${prop.title}</th></tr>`;
			});
			popupContent += `</table><br><a href="#update">עדכון</a>`;
			return popupContent;
		}
	  	
	</script>
</body>
</html>
